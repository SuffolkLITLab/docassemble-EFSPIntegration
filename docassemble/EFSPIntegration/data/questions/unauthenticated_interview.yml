---
modules:
  - .efm_client
  - .conversions
---
include:
  - login_qs.yml
  - common_qs.yml
---
objects:
  person_to_reg: Individual
---
code: |
  user_admin_list = [
    ('self_resend_activation', 'Resend Self Activitation Email'),
    ('reset_user_password', 'Reset Your Password'),
  ]
---
code: |
  user_registration_choices = [
    ('INDIVIDUAL', 'Pro Se user'),
    ('FIRM_ADMINISTRATOR', 'Administrator of a new firm')
  ]
---
question: | 
  What would you like to do?
subquestion: |

  ${ action_button_html(url_ask(
      [{'recompute': ['register_introduction', 'person_to_reg', 'register', 'register_status']}]),
      label='Register') }

  % for elem in user_admin_list:
  ${ action_button_html(url_ask(
      [{'recompute': [elem[0], 'show_resp']}]), 
      label=elem[1]) }

  % endfor

continue button field: all_done
---
question: |
  Email
fields:
  - Email: my_email
---
code: |
  resp = proxy_conn.reset_user_password(email=my_email)
  del my_email
  reset_user_password = True
---
code: |
  resp = proxy_conn.self_resend_activation_email(my_email)
  del my_email
  self_resend_activation = True
---
code: |
  resp = proxy_conn.register_user(person_to_reg, registration_type='INDIVIDUAL', password=new_password)
  del new_password
  register = True
---
question: |
  show resp:
subquestion: |
  ${ pretty_display(resp) }
continue button field: show_resp
---
question: |
  % if resp.is_ok():
  Successfully registered
  % else:
  Something went wrong when we tried to register your account
  % endif
subquestion: |
  % if resp.is_ok():
  You will get an email from eFileIl asking you to activate your account.
  
  [Resend activation email](${ url_ask([{'recompute': ['self_resend_activation','show_resp']}]) })

  % endif
  % if not resp.is_ok():
  % if get_config('debug'):
  ${ resp }
  % endif
  % endif

continue button field: register_status
---
question: |
  This website will help you register as an e-file user in Illinois
continue button field: register_introduction  
---
mandatory: True
code: |
  all_done
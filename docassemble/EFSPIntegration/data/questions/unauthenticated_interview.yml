---
modules:
  - .efm_client
  - .conversions
---
include:
  - login_qs.yml
  - common_qs.yml
---
objects:
  person_to_reg: Individual
---
code: |
  user_admin_list = [
    ('self_resend_activation', 'Resend Self Activitation Email'),
    ('reset_user_password', 'Reset Your Password'),
  ]
---
question: | 
  What to do?
subquestion: |

  ${ action_button_html(url_ask(
      [{'recompute': ['person_to_reg', 'register', 'show_resp']}]),
      label='Register') }

  % for elem in user_admin_list:
  ${ action_button_html(url_ask(
      [{'recompute': [elem[0], 'show_resp']}]), 
      label=elem[1]) }

  % endfor

continue button field: all_done
---
question: |
  Email
fields:
  - Email: my_email
---
code: |
  resp = proxy_conn.reset_user_password(email=my_email)
  del my_email
  reset_user_password = True
---
code: |
  resp = proxy_conn.self_resend_activation_email(my_email)
  del my_email
  self_resend_activation = True
---
---
question: |
  show resp:
subquestion: |
  ${ pretty_display(resp) }
continue button field: show_resp
---
id: registration type
question: |
  Registration Type
fields:
  - Registration type: reg_type
    datatype: radio
    choices:
      - Pro se user: INDIVIDUAL
      - Administrator of a new firm: FIRM_ADMINISTRATOR
  - note: |
      ---
  - Email address: person_to_reg.email
    datatype: email
  - Password: new_password
    datatype: password
    
  - Phone number: person_to_reg.phone_number
    validate: phone_number_is_valid
    maxlength: 20
    # TODO: should we use the real regex? Feels unnecessary
  - Firm name: person_to_reg.firm_name
    show if:
      variable: reg_type
      is: FIRM_ADMINISTRATOR  
  - First name: person_to_reg.name.first
  - Middle name: person_to_reg.name.middle
    required: False
  - Last name: person_to_reg.name.last
  - note: |
      ---
  - Street address: person_to_reg.address.address
    required: False
  - Unit: person_to_reg.address.unit
    required: False
  - City: person_to_reg.address.city
  - State: person_to_reg.address.state
    code: states_list()
    default: IL
  - Zip: person_to_reg.address.zip
  - Country: person_to_reg.address.country
    code: countries_list()
    default: US
---
mandatory: True
code: |
  all_done
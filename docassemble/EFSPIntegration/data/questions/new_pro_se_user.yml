---
modules:
  - .efm_client
---
code: |
  proxy_conn = ProxyConnection()
---
include: 
  - login_qs.yml
---
mandatory: True
code: |
  introduction
  person_to_reg.email
  register
  register_status
---
code: |
  password_rules = proxy_conn.get_password_rules()
---
code: |
  resp = proxy_conn.register_user(person_to_reg, registration_type='INDIVIDUAL', password=new_password)
  del new_password
  register = True
---
objects:
  - person_to_reg: Individual
---
question: |
  This website will help you register as an e-file user in Illinois
continue button field: introduction  
---
question: |
  Register new user
fields:
  - Email address: person_to_reg.email
    datatype: email
  - Password: new_password
    datatype: password
    validate: proxy_conn.is_valid_password
  - note: |
      ${ password_rules.data.get("validationmessage") }
  - Phone number: person_to_reg.phone_number
  - First name: person_to_reg.name.first
  - Middle name: person_to_reg.name.middle
    required: False
  - Last name: person_to_reg.name.last
  - note: |
      ---
  - Street address: person_to_reg.address.address
    required: False
    address autocomplete: True
  - Unit: person_to_reg.address.unit
    required: False
  - City: person_to_reg.address.city
  - State: person_to_reg.address.state
    code: states_list()
    default: IL
  - Zip: person_to_reg.address.zip
  - Country: person_to_reg.address.country
    code: countries_list()
    default: US
---
event: register_status
question: |
  % if resp.is_ok():
  Successfully registered
  % else:
  Something went wrong when we tried to register your account
  % if get_config('debug'):
  ${ resp }
  % endif
  % endif
subquestion: |
  % if resp.is_ok():
  You will get an email from eFileIl asking you to activate your account.
  
  
  [Resend activation email](${ url_ask([{'recompute': ['self_resend_activation','show_resp']}]) })

  % endif
buttons:
  - restart
---
code: |
  resp = proxy_conn.self_resend_activation_email(person_to_reg.email)
  self_resend_activation = True